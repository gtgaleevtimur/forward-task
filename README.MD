# Сервис проверки физлица на риски по реестру массовых учредителей.
#### Pre-Job task.
## Условия
1. На сайте ФНС есть набор данных - реестр массовых учредителей. Описание набора данных по ссылке https://www.nalog.ru/opendata/7707329152-massfounders/

Необходимо создать сервис предоставляющий доступ к этой проверке. Сервис должен быть написан на языке Go с соблюдением следующих конвенций.

Конфигурирование сервиса происходит тремя способами. 
    Они приведены ниже в порядке снижения приоритета

      1.1 Аргументы командной строки

      1.2 Переменные окружения

      1.3 Конфигурационный файл


2. Модуль реализует два функциональных блока

2.1 Обновление данных с сайта ФНС Работа в этом блоке идет следующим образом

   Модуль стартует с ключом командной строки update-registry
   Скачивает с сайта ФНС набор данных, преобразует в удобный формат для обработки и сохраняет в БД (БД по выбору исполнителя, параметры доступа к БД настраиваются в соответствии с п. 1)

2.2 Предоставление доступа к проверке: Работа в этом блоке идет следующим образом

Модуль стартует в видет web сервера с ключом запуска serve (параметры доступа к БД и порт прослушивания сервера настраиваются в соответствии с п. 1)
    Модуль предоставляет к проверке по REST API реализуя метод GET по следующему URI "/check/{ИНН}", где {ИНН} - ИНН проверяемого физического лица
    Ответ на запрос возвращается в формате JSON следующего вида

    {
        success: true,
        count: 0
    }

или

    {
        success:false,
        count: 3
    }

count - количество юридических лиц в которых фигурирует проверяемое физ. лицо (значение есть в наборе данных)

## Реализация задания
1. Для создания конфигурационного файла предусмотренны три варианта:флаги, переменные окружения и json-файл.

Доступные флаги:

      -а=SERVER_ADDRESS

      -m=SERVER_MODE

      -c=CONFIG

Доступные переменные окружения:

      env:"SERVER_ADDRESS"

      env:"SERVER_MODE"

JSON-файл находится и считывается из директории ./pkg/
В нем есть возможность установить режим работы приложения и адрес сервера, если не заданы флаги и не заданы переменные.

### Примеры команд для запуска

Для запуска в режиме update-registry через аргументы командной строки:

      -go run ./cmd/main.go -m=update-registry

Для запуска в режиме serve на порту localhost:8080 через аргументы командной строки:

      -go run ./cmd/main.go -m=serve -a=:8080

Для запуска с помощью переменные окружения необходимо задать переменные перед запуском и запустить main.go.
На Go к примеру так:

      os.Setenv("SERVER_ADDRESS", ":8080")
      os.Setenv("SERVER_MODE","serve")

Для запуска из конфигурационного файла, настроить config.json в ./pkg/ запустить без флагов и переменных.

### Детали работы приложения.

При запуске приложения происходит инициализация БД,а именно приложение переходит на 
https://www.nalog.gov.ru/opendata/7707329152-massfounders/ ищет ссылку
https://data.nalog.ru/opendata/7707329152-massfounders/data-22052021-structure-24062015.csv
по CSS селектору(я предположил ,что csv-файл обновляется и соответственно обновляется гиперссылка 
на этот набор данных, но возможно не изменяется css-selector ссылки внутри html-странички) и скачивает 
csv-файл с набором данных в папку ./pkg/

Далее при запуске в режиме update-registry приложение десериализует полученный ранее CSV в массив сущностей для миграции в БД.
Далее средствами GORM приложение создает БД на основе SQLite3 в директории ./pkg/ , и заполняет ее из массива.

При запуске в режиме serve запускается сервер с единственный маршрутом GET /check/{INN}

Если в БД есть такой ИНН и количество ЮЛ > 0 , то запрос вернет success == false и count == количеству ЮЛ.
Иначе вернет success == true и count == 0 .

P.S. Ввиду приведенных в условиях задачи примере я понял , что успешное выполнение запроса-это отсутствие человека в БД 
или ,если он попал по ошибке, если количество ЮЛ зарегистрированных за ним равно 0.
Неудачный результат - если по вводному ИНН приложение возвращает больше 0 ЮЛ.
Ожидается что количество ЮЛ всегда положительное число ,т.е.>=0.
